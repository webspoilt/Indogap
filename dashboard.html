<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IndoGap AI Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .mono {
            font-family: 'JetBrains Mono', monospace;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
        }

        .card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .score-high {
            color: #10b981;
        }

        .score-medium {
            color: #f59e0b;
        }

        .score-low {
            color: #ef4444;
        }

        .loader {
            border: 3px solid #1e293b;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: .5;
            }
        }
    </style>
</head>

<body class="gradient-bg min-h-screen text-white">
    <!-- Sidebar -->
    <nav class="fixed left-0 top-0 h-full w-64 bg-slate-900/90 border-r border-slate-700 p-4">
        <div class="mb-8">
            <h1 class="text-xl font-bold text-blue-400">IndoGap AI</h1>
            <p class="text-xs text-slate-400">Opportunity Discovery Engine</p>
        </div>
        <ul class="space-y-2" id="nav-menu">
            <li><button onclick="showSection('dashboard')"
                    class="nav-btn w-full text-left px-4 py-2 rounded bg-blue-600"
                    data-section="dashboard">Dashboard</button></li>
            <li><button onclick="showSection('scrape')"
                    class="nav-btn w-full text-left px-4 py-2 rounded hover:bg-slate-700" data-section="scrape">Scrape
                    Data</button></li>
            <li><button onclick="showSection('analyze')"
                    class="nav-btn w-full text-left px-4 py-2 rounded hover:bg-slate-700"
                    data-section="analyze">Analyze</button></li>
            <li><button onclick="showSection('opportunities')"
                    class="nav-btn w-full text-left px-4 py-2 rounded hover:bg-slate-700"
                    data-section="opportunities">Opportunities</button></li>
            <li><button onclick="showSection('admin')"
                    class="nav-btn w-full text-left px-4 py-2 rounded hover:bg-slate-700 text-yellow-400"
                    data-section="admin" id="admin-nav">üîê Admin</button></li>
            <li><button onclick="showSection('settings')"
                    class="nav-btn w-full text-left px-4 py-2 rounded hover:bg-slate-700"
                    data-section="settings">Settings</button></li>
        </ul>

        <!-- System Monitor -->
        <div class="absolute bottom-4 left-4 right-4">
            <h3 class="text-xs font-semibold text-slate-400 mb-2">SYSTEM RESOURCES</h3>
            <div id="system-stats" class="text-xs space-y-1">
                <div class="flex justify-between"><span>RAM:</span><span id="ram-stat">Loading...</span></div>
                <div class="flex justify-between"><span>VRAM:</span><span id="vram-stat">Loading...</span></div>
                <div class="flex justify-between"><span>Model:</span><span id="model-stat">None</span></div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="ml-64 p-8">
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <div>
                <h2 id="page-title" class="text-2xl font-bold">Dashboard</h2>
                <p id="page-subtitle" class="text-slate-400">System overview and quick actions</p>
            </div>
            <div class="flex items-center gap-4">
                <span id="auth-status" class="text-sm text-slate-400"></span>
                <button id="auth-btn" onclick="toggleAuth()"
                    class="px-3 py-1 rounded bg-slate-700 hover:bg-slate-600 text-sm">Login</button>
                <span id="connection-status" class="flex items-center gap-2 text-green-400">
                    <span class="w-2 h-2 bg-green-400 rounded-full"></span>
                    Connected
                </span>
            </div>
        </header>

        <!-- Dashboard Section -->
        <section id="dashboard-section">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="card rounded-xl p-6">
                    <div class="text-slate-400 text-sm">Total Opportunities</div>
                    <div class="text-3xl font-bold mt-2" id="total-opps">0</div>
                </div>
                <div class="card rounded-xl p-6">
                    <div class="text-slate-400 text-sm">High Priority</div>
                    <div class="text-3xl font-bold mt-2 text-green-400" id="high-priority">0</div>
                </div>
                <div class="card rounded-xl p-6">
                    <div class="text-slate-400 text-sm">Avg Gap Score</div>
                    <div class="text-3xl font-bold mt-2 text-blue-400" id="avg-gap">0.00</div>
                </div>
                <div class="card rounded-xl p-6">
                    <div class="text-slate-400 text-sm">Scraped Today</div>
                    <div class="text-3xl font-bold mt-2 text-purple-400" id="scraped-today">0</div>
                </div>
            </div>

            <div class="card rounded-xl p-6">
                <h3 class="text-lg font-semibold mb-4">Quick Actions</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="runDemo()" class="p-4 rounded bg-slate-700 hover:bg-slate-600 text-left">
                        <div class="font-semibold">Run Demo Analysis</div>
                        <div class="text-sm text-slate-400">Test with sample YC companies</div>
                    </button>
                    <button onclick="scrapeSource('yc')" class="p-4 rounded bg-slate-700 hover:bg-slate-600 text-left">
                        <div class="font-semibold">Scrape Y Combinator</div>
                        <div class="text-sm text-slate-400">Latest batch companies</div>
                    </button>
                    <button onclick="scrapeSource('ph')" class="p-4 rounded bg-slate-700 hover:bg-slate-600 text-left">
                        <div class="font-semibold">Scrape Product Hunt</div>
                        <div class="text-sm text-slate-400">Trending products</div>
                    </button>
                    <button onclick="bulkAnalyze()" class="p-4 rounded bg-green-700 hover:bg-green-600 text-left">
                        <div class="font-semibold">Bulk Analyze</div>
                        <div class="text-sm text-slate-200">Process pending startups</div>
                    </button>
                </div>
            </div>
        </section>

        <!-- Scrape Section -->
        <section id="scrape-section" class="hidden">
            <div class="card rounded-xl p-6">
                <h3 class="text-lg font-semibold mb-4">Data Sources</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="p-4 rounded border border-slate-600">
                        <h4 class="font-semibold mb-2">Y Combinator</h4>
                        <p class="text-sm text-slate-400 mb-4">Scrape companies from YC batches</p>
                        <input type="text" id="yc-batch" placeholder="Batch (e.g., W24)"
                            class="w-full p-2 rounded bg-slate-800 border border-slate-600 mb-2">
                        <button onclick="scrapeYC()" class="px-4 py-2 bg-blue-600 rounded hover:bg-blue-500">Scrape
                            YC</button>
                    </div>
                    <div class="p-4 rounded border border-slate-600">
                        <h4 class="font-semibold mb-2">Product Hunt</h4>
                        <p class="text-sm text-slate-400 mb-4">Scrape trending products</p>
                        <button onclick="scrapePH()" class="px-4 py-2 bg-purple-600 rounded hover:bg-purple-500">Scrape
                            PH</button>
                    </div>
                </div>
                <div id="scrape-status" class="mt-4 hidden">
                    <div class="flex items-center gap-2">
                        <div class="loader"></div>
                        <span id="scrape-message">Processing...</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Analyze Section -->
        <section id="analyze-section" class="hidden">
            <div class="card rounded-xl p-6 max-w-2xl">
                <h3 class="text-lg font-semibold mb-4">Analyze Startup</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Startup Name</label>
                        <input type="text" id="analyze-name"
                            class="w-full p-2 rounded bg-slate-800 border border-slate-600">
                    </div>
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Description</label>
                        <textarea id="analyze-desc" rows="3"
                            class="w-full p-2 rounded bg-slate-800 border border-slate-600"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Tags (comma-separated)</label>
                        <input type="text" id="analyze-tags"
                            class="w-full p-2 rounded bg-slate-800 border border-slate-600">
                    </div>
                    <button onclick="analyzeStartup()" class="px-4 py-2 bg-green-600 rounded hover:bg-green-500">Analyze
                        Opportunity</button>
                </div>
                <div id="analysis-result" class="mt-4 hidden">
                    <div class="p-4 rounded bg-slate-800 mono text-sm whitespace-pre-wrap"></div>
                </div>
            </div>
        </section>

        <!-- Opportunities Section -->
        <section id="opportunities-section" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">All Opportunities</h3>
                <div class="flex gap-2">
                    <select id="filter-level" onchange="filterOpportunities()"
                        class="p-2 rounded bg-slate-800 border border-slate-600">
                        <option value="all">All Levels</option>
                        <option value="high">High Priority</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
            </div>
            <div id="opportunities-list" class="space-y-4">
                <!-- Opportunities will be rendered here -->
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings-section" class="hidden">
            <div class="card rounded-xl p-6 max-w-2xl">
                <h3 class="text-lg font-semibold mb-4">Settings</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Ollama Host</label>
                        <input type="text" id="ollama-host" value="http://localhost:11434"
                            class="w-full p-2 rounded bg-slate-800 border border-slate-600">
                    </div>
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">HuggingFace Token (Optional)</label>
                        <input type="password" id="hf-token" placeholder="Free tier backup"
                            class="w-full p-2 rounded bg-slate-800 border border-slate-600">
                    </div>
                    <button onclick="saveSettings()" class="px-4 py-2 bg-blue-600 rounded hover:bg-blue-500">Save
                        Settings</button>
                </div>
            </div>

            <div class="card rounded-xl p-6 mt-6">
                <h3 class="text-lg font-semibold mb-4">Installed Models</h3>
                <div id="models-list" class="space-y-2">
                    <!-- Models will be listed here -->
                </div>
            </div>
        </section>

        <!-- Admin Section -->
        <section id="admin-section" class="hidden">
            <div id="admin-login-prompt" class="card rounded-xl p-6 max-w-md mx-auto">
                <h3 class="text-lg font-semibold mb-4 text-center">üîê Admin Login Required</h3>
                <p class="text-slate-400 text-center mb-4">Please login to access admin features</p>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Username</label>
                        <input type="text" id="admin-username"
                            class="w-full p-2 rounded bg-slate-800 border border-slate-600" placeholder="admin">
                    </div>
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Password</label>
                        <input type="password" id="admin-password"
                            class="w-full p-2 rounded bg-slate-800 border border-slate-600"
                            onkeypress="if(event.key==='Enter')adminLogin()">
                    </div>
                    <button onclick="adminLogin()"
                        class="w-full px-4 py-2 bg-yellow-600 rounded hover:bg-yellow-500 font-semibold">Login</button>
                    <p id="login-error" class="text-red-400 text-sm text-center hidden"></p>
                </div>
            </div>

            <div id="admin-content" class="hidden">
                <!-- Admin Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="card rounded-xl p-4">
                        <div class="text-slate-400 text-sm">Opportunities</div>
                        <div class="text-2xl font-bold mt-1" id="admin-opps-count">0</div>
                    </div>
                    <div class="card rounded-xl p-4">
                        <div class="text-slate-400 text-sm">Global Startups</div>
                        <div class="text-2xl font-bold mt-1 text-blue-400" id="admin-global-count">0</div>
                    </div>
                    <div class="card rounded-xl p-4">
                        <div class="text-slate-400 text-sm">Indian Startups</div>
                        <div class="text-2xl font-bold mt-1 text-green-400" id="admin-indian-count">0</div>
                    </div>
                    <div class="card rounded-xl p-4">
                        <div class="text-slate-400 text-sm">High Priority</div>
                        <div class="text-2xl font-bold mt-1 text-yellow-400" id="admin-high-count">0</div>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="flex gap-2 mb-4">
                    <button onclick="loadAdminTab('opportunities')" class="admin-tab px-4 py-2 rounded bg-slate-700"
                        data-tab="opportunities">Opportunities</button>
                    <button onclick="loadAdminTab('global')" class="admin-tab px-4 py-2 rounded bg-slate-800"
                        data-tab="global">Global Startups</button>
                    <button onclick="loadAdminTab('indian')" class="admin-tab px-4 py-2 rounded bg-slate-800"
                        data-tab="indian">Indian Startups</button>
                </div>

                <!-- Data Table -->
                <div class="card rounded-xl p-4 overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead id="admin-table-head" class="text-left text-slate-400 border-b border-slate-600">
                        </thead>
                        <tbody id="admin-table-body" class="divide-y divide-slate-700">
                        </tbody>
                    </table>
                    <p id="admin-no-data" class="text-center text-slate-400 py-8 hidden">No data available</p>
                </div>
            </div>
        </section>
    </main>

    <script>
        // API Base URL
        const API_URL = '';

        // Section Navigation
        function showSection(section) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(section + '-section').classList.remove('hidden');

            const titles = {
                dashboard: ['Dashboard', 'System overview and quick actions'],
                scrape: ['Scrape Data', 'Collect data from sources'],
                analyze: ['Analyze', 'Analyze individual startups'],
                opportunities: ['Opportunities', 'View all identified gaps'],
                settings: ['Settings', 'Configure AI models and APIs']
            };
            document.getElementById('page-title').textContent = titles[section][0];
            document.getElementById('page-subtitle').textContent = titles[section][1];

            if (section === 'dashboard') loadDashboard();
            if (section === 'opportunities') loadOpportunities();
            if (section === 'settings') loadSettings();
        }

        // System Stats
        async function updateSystemStats() {
            try {
                const response = await fetch(API_URL + '/api/system/stats');
                const stats = await response.json();
                document.getElementById('ram-stat').textContent =
                    stats.ram_used_gb.toFixed(1) + '/' + stats.ram_total_gb.toFixed(1) + ' GB (' +
                    stats.ram_percent.toFixed(1) + '%)';
                if (stats.vram_used_gb !== null) {
                    document.getElementById('vram-stat').textContent =
                        stats.vram_used_gb.toFixed(1) + ' GB';
                } else {
                    document.getElementById('vram-stat').textContent = 'N/A';
                }
            } catch (e) {
                console.error('Failed to get stats:', e);
            }
        }

        setInterval(updateSystemStats, 2000);
        updateSystemStats();

        // Dashboard
        async function loadDashboard() {
            try {
                const response = await fetch(API_URL + '/api/opportunities');
                const opportunities = await response.json();

                document.getElementById('total-opps').textContent = opportunities.length;

                const high = opportunities.filter(o => o.opportunity_level === 'HIGH').length;
                document.getElementById('high-priority').textContent = high;

                if (opportunities.length > 0) {
                    const avgGap = opportunities.reduce((a, b) => a + b.gap_score, 0) / opportunities.length;
                    document.getElementById('avg-gap').textContent = avgGap.toFixed(2);
                }
            } catch (e) {
                console.error('Failed to load dashboard:', e);
            }
        }

        // Scrape
        async function scrapeSource(source) {
            document.getElementById('scrape-status').classList.remove('hidden');
            document.getElementById('scrape-message').textContent = 'Scraping ' + source.toUpperCase() + '...';

            try {
                const response = await fetch(API_URL + '/api/scrape', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ source: source })
                });
                const result = await response.json();
                document.getElementById('scrape-message').textContent =
                    'Success! Scraped ' + result.count + ' items';
                setTimeout(() => {
                    document.getElementById('scrape-status').classList.add('hidden');
                }, 3000);
            } catch (e) {
                document.getElementById('scrape-message').textContent = 'Error: ' + e.message;
            }
        }

        async function scrapeYC() {
            const batch = document.getElementById('yc-batch').value;
            await scrapeSource('yc' + (batch ? '?batch=' + batch : ''));
        }

        async function scrapePH() {
            await scrapeSource('ph');
        }

        async function bulkAnalyze() {
            if (!confirm('Start bulk analysis for pending startups? This runs in the background.')) return;

            const btn = event.currentTarget;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<div class="font-semibold">Starting...</div>';

            try {
                const response = await fetch(API_URL + '/api/analyze/bulk', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ limit: 5 })
                });
                const result = await response.json();

                alert(result.message);

                // Show notification or visual feedback
                if (result.count > 0) {
                    btn.innerHTML = `<div class="font-semibold">Analyzing ${result.count}...</div><div class="text-xs text-slate-200">Check logs</div>`;
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        loadDashboard(); // Refresh stats
                    }, 5000);
                } else {
                    btn.innerHTML = originalText;
                }

            } catch (e) {
                alert('Error: ' + e.message);
                btn.innerHTML = originalText;
            }
        }

        // Analyze
        async function analyzeStartup() {
            const name = document.getElementById('analyze-name').value;
            const desc = document.getElementById('analyze-desc').value;
            const tags = document.getElementById('analyze-tags').value.split(',').map(t => t.trim());

            const resultDiv = document.getElementById('analysis-result');
            resultDiv.classList.remove('hidden');
            resultDiv.querySelector('.mono').textContent = 'Analyzing...';

            try {
                const response = await fetch(API_URL + '/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        startup_name: name,
                        description: desc,
                        tags: tags
                    })
                });
                const result = await response.json();
                resultDiv.querySelector('.mono').textContent = JSON.stringify(result, null, 2);
            } catch (e) {
                resultDiv.querySelector('.mono').textContent = 'Error: ' + e.message;
            }
        }

        // Opportunities
        async function loadOpportunities() {
            try {
                const response = await fetch(API_URL + '/api/opportunities');
                const opportunities = await response.json();

                const container = document.getElementById('opportunities-list');
                container.innerHTML = opportunities.map(opp => `
                    <div class="card rounded-xl p-4" data-level="${opp.opportunity_level.toLowerCase()}">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-semibold">${opp.name}</h4>
                                <p class="text-sm text-slate-400">${opp.description.substring(0, 100)}...</p>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold ${opp.gap_score >= 0.7 ? 'score-high' : opp.gap_score >= 0.4 ? 'score-medium' : 'score-low'}">
                                    ${opp.gap_score.toFixed(2)}
                                </div>
                                <div class="text-xs text-slate-400">Gap Score</div>
                            </div>
                        </div>
                        <div class="mt-2 flex gap-2">
                            <span class="px-2 py-1 rounded bg-slate-700 text-xs">${opp.source}</span>
                            <span class="px-2 py-1 rounded ${opp.opportunity_level === 'HIGH' ? 'bg-green-900' : opp.opportunity_level === 'MEDIUM' ? 'bg-yellow-900' : 'bg-red-900'} text-xs">
                                ${opp.opportunity_level}
                            </span>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                console.error('Failed to load opportunities:', e);
            }
        }

        function filterOpportunities() {
            const level = document.getElementById('filter-level').value;
            document.querySelectorAll('#opportunities-list > div').forEach(card => {
                if (level === 'all' || card.dataset.level === level) {
                    card.classList.remove('hidden');
                } else {
                    card.classList.add('hidden');
                }
            });
        }

        // Settings
        async function loadSettings() {
            try {
                const response = await fetch(API_URL + '/api/health');
                const health = await response.json();

                document.getElementById('models-list').innerHTML =
                    health.models_available.map(m =>
                        '<div class="p-2 rounded bg-slate-800 mono text-sm">' + m + '</div>'
                    ).join('');
            } catch (e) {
                document.getElementById('models-list').innerHTML = '<p class="text-red-400">Failed to load models</p>';
            }
        }

        function saveSettings() {
            alert('Settings saved! Restart the server for changes to take effect.');
        }

        // Demo
        async function runDemo() {
            if (confirm('Run demo analysis? This will analyze sample YC companies.')) {
                try {
                    const response = await fetch(API_URL + '/api/demo', { method: 'POST' });
                    const result = await response.json();
                    alert('Demo complete! Analyzed ' + result.count + ' opportunities.');
                    loadDashboard();
                } catch (e) {
                    alert('Demo failed: ' + e.message);
                }
            }
        }

        // ============== AUTH FUNCTIONS ==============
        let authToken = localStorage.getItem('adminToken');
        let currentAdminTab = 'opportunities';

        function updateAuthUI() {
            const authBtn = document.getElementById('auth-btn');
            const authStatus = document.getElementById('auth-status');
            if (authToken) {
                authBtn.textContent = 'Logout';
                authBtn.classList.remove('bg-slate-700');
                authBtn.classList.add('bg-red-700', 'hover:bg-red-600');
                authStatus.textContent = 'Admin';
                authStatus.classList.add('text-yellow-400');
            } else {
                authBtn.textContent = 'Login';
                authBtn.classList.add('bg-slate-700');
                authBtn.classList.remove('bg-red-700', 'hover:bg-red-600');
                authStatus.textContent = '';
                authStatus.classList.remove('text-yellow-400');
            }
        }

        function toggleAuth() {
            if (authToken) {
                adminLogout();
            } else {
                showSection('admin');
            }
        }

        async function adminLogin() {
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            const errorEl = document.getElementById('login-error');

            try {
                const response = await fetch(API_URL + '/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                if (response.ok) {
                    const data = await response.json();
                    authToken = data.token;
                    localStorage.setItem('adminToken', authToken);
                    errorEl.classList.add('hidden');
                    updateAuthUI();
                    showAdminContent();
                    loadAdminStats();
                    loadAdminTab('opportunities');
                } else {
                    errorEl.textContent = 'Invalid credentials';
                    errorEl.classList.remove('hidden');
                }
            } catch (e) {
                errorEl.textContent = 'Login failed: ' + e.message;
                errorEl.classList.remove('hidden');
            }
        }

        async function adminLogout() {
            try {
                await fetch(API_URL + '/api/auth/logout', {
                    method: 'POST',
                    headers: { 'Authorization': 'Bearer ' + authToken }
                });
            } catch (e) { }
            authToken = null;
            localStorage.removeItem('adminToken');
            updateAuthUI();
            document.getElementById('admin-login-prompt').classList.remove('hidden');
            document.getElementById('admin-content').classList.add('hidden');
        }

        function showAdminContent() {
            document.getElementById('admin-login-prompt').classList.add('hidden');
            document.getElementById('admin-content').classList.remove('hidden');
        }

        async function loadAdminStats() {
            try {
                const response = await fetch(API_URL + '/api/admin/stats', {
                    headers: { 'Authorization': 'Bearer ' + authToken }
                });
                if (response.status === 401) { adminLogout(); return; }
                const stats = await response.json();
                document.getElementById('admin-opps-count').textContent = stats.opportunities_count || 0;
                document.getElementById('admin-global-count').textContent = stats.global_startups_count || 0;
                document.getElementById('admin-indian-count').textContent = stats.indian_startups_count || 0;
                document.getElementById('admin-high-count').textContent = stats.opportunities_by_level?.high || 0;
            } catch (e) {
                console.error('Failed to load admin stats:', e);
            }
        }

        async function loadAdminTab(tab) {
            currentAdminTab = tab;
            document.querySelectorAll('.admin-tab').forEach(btn => {
                btn.classList.remove('bg-slate-700');
                btn.classList.add('bg-slate-800');
            });
            document.querySelector(`.admin-tab[data-tab="${tab}"]`).classList.remove('bg-slate-800');
            document.querySelector(`.admin-tab[data-tab="${tab}"]`).classList.add('bg-slate-700');

            const endpoints = {
                opportunities: '/api/admin/opportunities',
                global: '/api/admin/global-startups',
                indian: '/api/admin/indian-startups'
            };

            try {
                const response = await fetch(API_URL + endpoints[tab], {
                    headers: { 'Authorization': 'Bearer ' + authToken }
                });
                if (response.status === 401) { adminLogout(); return; }
                const data = await response.json();
                renderAdminTable(tab, data);
            } catch (e) {
                console.error('Failed to load admin data:', e);
            }
        }

        function renderAdminTable(tab, data) {
            const thead = document.getElementById('admin-table-head');
            const tbody = document.getElementById('admin-table-body');
            const noData = document.getElementById('admin-no-data');

            const items = data.opportunities || data.startups || [];

            if (items.length === 0) {
                thead.innerHTML = '';
                tbody.innerHTML = '';
                noData.classList.remove('hidden');
                return;
            }
            noData.classList.add('hidden');

            const columns = {
                opportunities: ['name', 'source', 'gap_score', 'opportunity_level', 'created_at'],
                global: ['name', 'source', 'batch', 'tags', 'created_at'],
                indian: ['name', 'category', 'headquarters', 'status', 'created_at']
            };

            thead.innerHTML = '<tr>' + columns[tab].map(c =>
                `<th class="py-2 px-3">${c.replace('_', ' ').toUpperCase()}</th>`
            ).join('') + '</tr>';

            tbody.innerHTML = items.map(item => '<tr class="hover:bg-slate-800">' +
                columns[tab].map(c => {
                    let val = item[c];
                    if (c === 'gap_score' && val) val = val.toFixed(2);
                    if (c === 'tags' && Array.isArray(val)) val = val.slice(0, 3).join(', ');
                    if (c === 'created_at' && val) val = new Date(val).toLocaleDateString();
                    return `<td class="py-2 px-3">${val || '-'}</td>`;
                }).join('') +
                '</tr>').join('');
        }

        // Update showSection to handle admin
        const originalShowSection = showSection;
        function showSection(section) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(section + '-section').classList.remove('hidden');

            const titles = {
                dashboard: ['Dashboard', 'System overview and quick actions'],
                scrape: ['Scrape Data', 'Collect data from sources'],
                analyze: ['Analyze', 'Analyze individual startups'],
                opportunities: ['Opportunities', 'View all identified gaps'],
                admin: ['Admin Panel', 'Database management'],
                settings: ['Settings', 'Configure AI models and APIs']
            };
            document.getElementById('page-title').textContent = titles[section][0];
            document.getElementById('page-subtitle').textContent = titles[section][1];

            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600');
                btn.classList.add('hover:bg-slate-700');
            });
            const activeBtn = document.querySelector(`.nav-btn[data-section="${section}"]`);
            if (activeBtn) {
                activeBtn.classList.add('bg-blue-600');
                activeBtn.classList.remove('hover:bg-slate-700');
            }

            if (section === 'dashboard') loadDashboard();
            if (section === 'opportunities') loadOpportunities();
            if (section === 'settings') loadSettings();
            if (section === 'admin') {
                if (authToken) {
                    showAdminContent();
                    loadAdminStats();
                    loadAdminTab(currentAdminTab);
                }
            }
        }

        // Initialize
        updateAuthUI();
        showSection('dashboard');
    </script>
</body>

</html>