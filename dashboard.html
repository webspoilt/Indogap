<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IndoGap AI Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .gradient-bg {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
        }
        .card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        .score-high { color: #10b981; }
        .score-medium { color: #f59e0b; }
        .score-low { color: #ef4444; }
        .loader {
            border: 3px solid #1e293b;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <!-- Sidebar -->
    <nav class="fixed left-0 top-0 h-full w-64 bg-slate-900/90 border-r border-slate-700 p-4">
        <div class="mb-8">
            <h1 class="text-xl font-bold text-blue-400">IndoGap AI</h1>
            <p class="text-xs text-slate-400">Opportunity Discovery Engine</p>
        </div>
        <ul class="space-y-2">
            <li><button onclick="showSection('dashboard')" class="w-full text-left px-4 py-2 rounded bg-blue-600">Dashboard</button></li>
            <li><button onclick="showSection('scrape')" class="w-full text-left px-4 py-2 rounded hover:bg-slate-700">Scrape Data</button></li>
            <li><button onclick="showSection('analyze')" class="w-full text-left px-4 py-2 rounded hover:bg-slate-700">Analyze</button></li>
            <li><button onclick="showSection('opportunities')" class="w-full text-left px-4 py-2 rounded hover:bg-slate-700">Opportunities</button></li>
            <li><button onclick="showSection('settings')" class="w-full text-left px-4 py-2 rounded hover:bg-slate-700">Settings</button></li>
        </ul>
        
        <!-- System Monitor -->
        <div class="absolute bottom-4 left-4 right-4">
            <h3 class="text-xs font-semibold text-slate-400 mb-2">SYSTEM RESOURCES</h3>
            <div id="system-stats" class="text-xs space-y-1">
                <div class="flex justify-between"><span>RAM:</span><span id="ram-stat">Loading...</span></div>
                <div class="flex justify-between"><span>VRAM:</span><span id="vram-stat">Loading...</span></div>
                <div class="flex justify-between"><span>Model:</span><span id="model-stat">None</span></div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="ml-64 p-8">
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <div>
                <h2 id="page-title" class="text-2xl font-bold">Dashboard</h2>
                <p id="page-subtitle" class="text-slate-400">System overview and quick actions</p>
            </div>
            <div class="flex items-center gap-4">
                <span id="connection-status" class="flex items-center gap-2 text-green-400">
                    <span class="w-2 h-2 bg-green-400 rounded-full"></span>
                    Connected
                </span>
            </div>
        </header>

        <!-- Dashboard Section -->
        <section id="dashboard-section">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="card rounded-xl p-6">
                    <div class="text-slate-400 text-sm">Total Opportunities</div>
                    <div class="text-3xl font-bold mt-2" id="total-opps">0</div>
                </div>
                <div class="card rounded-xl p-6">
                    <div class="text-slate-400 text-sm">High Priority</div>
                    <div class="text-3xl font-bold mt-2 text-green-400" id="high-priority">0</div>
                </div>
                <div class="card rounded-xl p-6">
                    <div class="text-slate-400 text-sm">Avg Gap Score</div>
                    <div class="text-3xl font-bold mt-2 text-blue-400" id="avg-gap">0.00</div>
                </div>
                <div class="card rounded-xl p-6">
                    <div class="text-slate-400 text-sm">Scraped Today</div>
                    <div class="text-3xl font-bold mt-2 text-purple-400" id="scraped-today">0</div>
                </div>
            </div>

            <div class="card rounded-xl p-6">
                <h3 class="text-lg font-semibold mb-4">Quick Actions</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="runDemo()" class="p-4 rounded bg-slate-700 hover:bg-slate-600 text-left">
                        <div class="font-semibold">Run Demo Analysis</div>
                        <div class="text-sm text-slate-400">Test with sample YC companies</div>
                    </button>
                    <button onclick="scrapeSource('yc')" class="p-4 rounded bg-slate-700 hover:bg-slate-600 text-left">
                        <div class="font-semibold">Scrape Y Combinator</div>
                        <div class="text-sm text-slate-400">Latest batch companies</div>
                    </button>
                    <button onclick="scrapeSource('ph')" class="p-4 rounded bg-slate-700 hover:bg-slate-600 text-left">
                        <div class="font-semibold">Scrape Product Hunt</div>
                        <div class="text-sm text-slate-400">Trending products</div>
                    </button>
                </div>
            </div>
        </section>

        <!-- Scrape Section -->
        <section id="scrape-section" class="hidden">
            <div class="card rounded-xl p-6">
                <h3 class="text-lg font-semibold mb-4">Data Sources</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="p-4 rounded border border-slate-600">
                        <h4 class="font-semibold mb-2">Y Combinator</h4>
                        <p class="text-sm text-slate-400 mb-4">Scrape companies from YC batches</p>
                        <input type="text" id="yc-batch" placeholder="Batch (e.g., W24)" class="w-full p-2 rounded bg-slate-800 border border-slate-600 mb-2">
                        <button onclick="scrapeYC()" class="px-4 py-2 bg-blue-600 rounded hover:bg-blue-500">Scrape YC</button>
                    </div>
                    <div class="p-4 rounded border border-slate-600">
                        <h4 class="font-semibold mb-2">Product Hunt</h4>
                        <p class="text-sm text-slate-400 mb-4">Scrape trending products</p>
                        <button onclick="scrapePH()" class="px-4 py-2 bg-purple-600 rounded hover:bg-purple-500">Scrape PH</button>
                    </div>
                </div>
                <div id="scrape-status" class="mt-4 hidden">
                    <div class="flex items-center gap-2">
                        <div class="loader"></div>
                        <span id="scrape-message">Processing...</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Analyze Section -->
        <section id="analyze-section" class="hidden">
            <div class="card rounded-xl p-6 max-w-2xl">
                <h3 class="text-lg font-semibold mb-4">Analyze Startup</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Startup Name</label>
                        <input type="text" id="analyze-name" class="w-full p-2 rounded bg-slate-800 border border-slate-600">
                    </div>
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Description</label>
                        <textarea id="analyze-desc" rows="3" class="w-full p-2 rounded bg-slate-800 border border-slate-600"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Tags (comma-separated)</label>
                        <input type="text" id="analyze-tags" class="w-full p-2 rounded bg-slate-800 border border-slate-600">
                    </div>
                    <button onclick="analyzeStartup()" class="px-4 py-2 bg-green-600 rounded hover:bg-green-500">Analyze Opportunity</button>
                </div>
                <div id="analysis-result" class="mt-4 hidden">
                    <div class="p-4 rounded bg-slate-800 mono text-sm whitespace-pre-wrap"></div>
                </div>
            </div>
        </section>

        <!-- Opportunities Section -->
        <section id="opportunities-section" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">All Opportunities</h3>
                <div class="flex gap-2">
                    <select id="filter-level" onchange="filterOpportunities()" class="p-2 rounded bg-slate-800 border border-slate-600">
                        <option value="all">All Levels</option>
                        <option value="high">High Priority</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
            </div>
            <div id="opportunities-list" class="space-y-4">
                <!-- Opportunities will be rendered here -->
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings-section" class="hidden">
            <div class="card rounded-xl p-6 max-w-2xl">
                <h3 class="text-lg font-semibold mb-4">Settings</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Ollama Host</label>
                        <input type="text" id="ollama-host" value="http://localhost:11434" class="w-full p-2 rounded bg-slate-800 border border-slate-600">
                    </div>
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">HuggingFace Token (Optional)</label>
                        <input type="password" id="hf-token" placeholder="Free tier backup" class="w-full p-2 rounded bg-slate-800 border border-slate-600">
                    </div>
                    <button onclick="saveSettings()" class="px-4 py-2 bg-blue-600 rounded hover:bg-blue-500">Save Settings</button>
                </div>
            </div>
            
            <div class="card rounded-xl p-6 mt-6">
                <h3 class="text-lg font-semibold mb-4">Installed Models</h3>
                <div id="models-list" class="space-y-2">
                    <!-- Models will be listed here -->
                </div>
            </div>
        </section>
    </main>

    <script>
        // API Base URL
        const API_URL = '';
        
        // Section Navigation
        function showSection(section) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(section + '-section').classList.remove('hidden');
            
            const titles = {
                dashboard: ['Dashboard', 'System overview and quick actions'],
                scrape: ['Scrape Data', 'Collect data from sources'],
                analyze: ['Analyze', 'Analyze individual startups'],
                opportunities: ['Opportunities', 'View all identified gaps'],
                settings: ['Settings', 'Configure AI models and APIs']
            };
            document.getElementById('page-title').textContent = titles[section][0];
            document.getElementById('page-subtitle').textContent = titles[section][1];
            
            if (section === 'dashboard') loadDashboard();
            if (section === 'opportunities') loadOpportunities();
            if (section === 'settings') loadSettings();
        }

        // System Stats
        async function updateSystemStats() {
            try {
                const response = await fetch(API_URL + '/api/system/stats');
                const stats = await response.json();
                document.getElementById('ram-stat').textContent = 
                    stats.ram_used_gb.toFixed(1) + '/' + stats.ram_total_gb.toFixed(1) + ' GB (' + 
                    stats.ram_percent.toFixed(1) + '%)';
                if (stats.vram_used_gb !== null) {
                    document.getElementById('vram-stat').textContent = 
                        stats.vram_used_gb.toFixed(1) + ' GB';
                } else {
                    document.getElementById('vram-stat').textContent = 'N/A';
                }
            } catch (e) {
                console.error('Failed to get stats:', e);
            }
        }

        setInterval(updateSystemStats, 2000);
        updateSystemStats();

        // Dashboard
        async function loadDashboard() {
            try {
                const response = await fetch(API_URL + '/api/opportunities');
                const opportunities = await response.json();
                
                document.getElementById('total-opps').textContent = opportunities.length;
                
                const high = opportunities.filter(o => o.opportunity_level === 'HIGH').length;
                document.getElementById('high-priority').textContent = high;
                
                if (opportunities.length > 0) {
                    const avgGap = opportunities.reduce((a, b) => a + b.gap_score, 0) / opportunities.length;
                    document.getElementById('avg-gap').textContent = avgGap.toFixed(2);
                }
            } catch (e) {
                console.error('Failed to load dashboard:', e);
            }
        }

        // Scrape
        async function scrapeSource(source) {
            document.getElementById('scrape-status').classList.remove('hidden');
            document.getElementById('scrape-message').textContent = 'Scraping ' + source.toUpperCase() + '...';
            
            try {
                const response = await fetch(API_URL + '/api/scrape', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({source: source})
                });
                const result = await response.json();
                document.getElementById('scrape-message').textContent = 
                    'Success! Scraped ' + result.count + ' items';
                setTimeout(() => {
                    document.getElementById('scrape-status').classList.add('hidden');
                }, 3000);
            } catch (e) {
                document.getElementById('scrape-message').textContent = 'Error: ' + e.message;
            }
        }

        async function scrapeYC() {
            const batch = document.getElementById('yc-batch').value;
            await scrapeSource('yc' + (batch ? '?batch=' + batch : ''));
        }

        async function scrapePH() {
            await scrapeSource('ph');
        }

        // Analyze
        async function analyzeStartup() {
            const name = document.getElementById('analyze-name').value;
            const desc = document.getElementById('analyze-desc').value;
            const tags = document.getElementById('analyze-tags').value.split(',').map(t => t.trim());
            
            const resultDiv = document.getElementById('analysis-result');
            resultDiv.classList.remove('hidden');
            resultDiv.querySelector('.mono').textContent = 'Analyzing...';
            
            try {
                const response = await fetch(API_URL + '/api/analyze', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        startup_name: name,
                        description: desc,
                        tags: tags
                    })
                });
                const result = await response.json();
                resultDiv.querySelector('.mono').textContent = JSON.stringify(result, null, 2);
            } catch (e) {
                resultDiv.querySelector('.mono').textContent = 'Error: ' + e.message;
            }
        }

        // Opportunities
        async function loadOpportunities() {
            try {
                const response = await fetch(API_URL + '/api/opportunities');
                const opportunities = await response.json();
                
                const container = document.getElementById('opportunities-list');
                container.innerHTML = opportunities.map(opp => `
                    <div class="card rounded-xl p-4" data-level="${opp.opportunity_level.toLowerCase()}">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-semibold">${opp.name}</h4>
                                <p class="text-sm text-slate-400">${opp.description.substring(0, 100)}...</p>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold ${opp.gap_score >= 0.7 ? 'score-high' : opp.gap_score >= 0.4 ? 'score-medium' : 'score-low'}">
                                    ${opp.gap_score.toFixed(2)}
                                </div>
                                <div class="text-xs text-slate-400">Gap Score</div>
                            </div>
                        </div>
                        <div class="mt-2 flex gap-2">
                            <span class="px-2 py-1 rounded bg-slate-700 text-xs">${opp.source}</span>
                            <span class="px-2 py-1 rounded ${opp.opportunity_level === 'HIGH' ? 'bg-green-900' : opp.opportunity_level === 'MEDIUM' ? 'bg-yellow-900' : 'bg-red-900'} text-xs">
                                ${opp.opportunity_level}
                            </span>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                console.error('Failed to load opportunities:', e);
            }
        }

        function filterOpportunities() {
            const level = document.getElementById('filter-level').value;
            document.querySelectorAll('#opportunities-list > div').forEach(card => {
                if (level === 'all' || card.dataset.level === level) {
                    card.classList.remove('hidden');
                } else {
                    card.classList.add('hidden');
                }
            });
        }

        // Settings
        async function loadSettings() {
            try {
                const response = await fetch(API_URL + '/api/health');
                const health = await response.json();
                
                document.getElementById('models-list').innerHTML = 
                    health.models_available.map(m => 
                        '<div class="p-2 rounded bg-slate-800 mono text-sm">' + m + '</div>'
                    ).join('');
            } catch (e) {
                document.getElementById('models-list').innerHTML = '<p class="text-red-400">Failed to load models</p>';
            }
        }

        function saveSettings() {
            alert('Settings saved! Restart the server for changes to take effect.');
        }

        // Demo
        async function runDemo() {
            if (confirm('Run demo analysis? This will analyze sample YC companies.')) {
                try {
                    const response = await fetch(API_URL + '/api/demo', {method: 'POST'});
                    const result = await response.json();
                    alert('Demo complete! Analyzed ' + result.count + ' opportunities.');
                    loadDashboard();
                } catch (e) {
                    alert('Demo failed: ' + e.message);
                }
            }
        }

        // Initialize
        showSection('dashboard');
    </script>
</body>
</html>
